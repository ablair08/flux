apiVersion: flux.weave.works/v1beta1
kind: HelmRelease
metadata:
  name: concourse
  namespace: myproject
  annotations:
    flux.weave.works/automated: "true"
    flux.weave.works/tag.chart-image: semver:~1.0
spec:
  selector:
    matchLabels:
      app: concourse
  template:
    spec:
      securityContext:
        priviledged: true
    metadata:
      labels:
        app: concourse
  releaseName: concourse
  chart:
    git: ssh://git@github.com/ablair08/flux
    ref: master
    path: charts/concourse
    serviceType: ClusterIP
  values:
    securityContext:
      enabled: true
      fsGroup: 
      runAsUser: 1000140100
      runAsNonRoot: true
---
apiVersion: monitoring.coreos.com/v1
kind: ServiceMonitor
metadata:
  name: concourse
  namespace: myproject
  labels:
    team: frontend
spec:
  selector:
    matchLabels:
      app: concourse-web
  endpoints:
  - port: prometheus
---
apiVersion: extensions/v1beta1
kind: Ingress
metadata:
  name: concourse-web
  namespace: myproject
  annotations:
    nginx.ingress.kubernetes.io/rewrite-target: /
spec:
  rules:
  - host: concourse.minishift.local
    http:
      paths:
      - path: /
        backend:
          serviceName: concourse-web
          servicePort: atc